<div class="mb-4">
	<div class="row g-3">
		<div class="col-md-6">
			<label class="form-label">Berat Badan</label>
			<input type="text" name="berat_badan" class="form-control border-dark" placeholder="Kg">
		</div>
		<div class="col-md-6">
			<label class="form-label">Tinggi Badan</label>
			<input type="text" name="tinggi_badan" class="form-control border-dark" placeholder="Cm">
		</div>
	</div>

	<div class="row g-3">
		<div class="col-md-6">
			<label class="form-label">Keadaan Umum</label>
			<input type="text" name="keadaan_umum" class="form-control border-dark">
		</div>
		<div class="col-md-6">
			<label class="form-label">Pernafasan</label>
			<input type="text" name="pernafasan" class="form-control border-dark">
		</div>
		<div class="col-md-6">
			<label class="form-label">Keadaan Gizi</label>
			<input type="text" name="keadaan_gizi" class="form-control border-dark">
		</div>
		<div class="col-md-6">
			<label class="form-label">Jantung</label>
			<input type="text" name="jantung" class="form-control border-dark">
		</div>
		<div class="col-md-6">
			<label class="form-label">Kesadaran</label>
			<input type="text" name="kesadaran" class="form-control border-dark">
		</div>
		<div class="col-md-6">
			<label class="form-label">Paru-paru</label>
			<input type="text" name="paru_paru" class="form-control border-dark">
		</div>
		<div class="col-md-6">
			<label class="form-label">Kepala</label>
			<input type="text" name="kepala" class="form-control border-dark">
		</div>
		<div class="col-md-6">
			<label class="form-label">Nadi</label>
			<div class="d-flex gap-2 align-items-center">
				<input type="text" name="nadi" class="form-control border-dark w-75" placeholder="/Menit, Regular/Iregular"><label for="" class="flex-shrink-0">menit, Reguler / Ireguler</label>
			</div>
		</div>
		<div class="col-md-6">
			<label class="form-label">Leher</label>
			<input type="text" name="leher" class="form-control border-dark">

		</div>
		<div class="col-md-6">
			<label class="form-label">Tek. Darah</label>
			<div class="d-flex gap-2">
				<input type="text" name="tekanan_darah" class="form-control border-dark" placeholder="mm/hg">
				<label for="">mm/hg</label>
			</div>
		</div>
		<div class="col-md-6">
			<label class="form-label">Dada</label>
			<input type="text" name="dada" class="form-control border-dark">
		</div>
		<div class="col-md-6">
			<label class="form-label">Suhu</label>
			<div class="d-flex gap-2">
				<input type="text" name="suhu" class="form-control border-dark" placeholder="Â°C">
				<label for="">&deg;C</label>
			</div>
		</div>

		<div class="col-md-6">
			<label class="form-label">Anemia</label>
			<input type="text" name="anemia" class="form-control border-dark">
		</div>

		<div class="col-md-6">
			<label class="form-label">Turgor</label>
			<input type="text" name="turgor" class="form-control border-dark">
		</div>

		<div class="col-md-6">
			<label class="form-label">Ikterus</label>
			<input type="text" name="ikterus" class="form-control border-dark">
		</div>

		<div class="col-md-6">
			<label class="form-label">Edema</label>
			<input type="text" name="edema" class="form-control border-dark">
		</div>

		<div class="col-md-6">
			<label class="form-label">Sianosis</label>
			<input type="text" name="sianosis" class="form-control border-dark">
		</div>

		<div class="col-md-6">
			<label class="form-label">Refleks</label>
			<div class="d-flex flex-column">
				<div class="d-flex align-items-center">
					<span class="me-3">APR </span>
					<input type="text" name="refleks_apr" class="form-control border-dark mx-2 w-75">
				</div>

				<div class="d-flex align-items-center mt-3">
					<span class="me-3">KPR </span>
					<input type="text" name="refleks_kpr" class="form-control border-dark mx-2 w-75">
				</div>
			</div>
		</div>

		<div class="col-md-6">
			<label class="form-label">Varices</label>
			<input type="text" name="varices" class="form-control border-dark">
		</div>

		<h5 class="mb-3 mt-5">PEMERIKSAAN LOKAL :</h5>
		<div class="mb-4">
			<div class="row g-3">
				<div class="col-md-6">
					<label class="form-label">Perut :</label>
					<textarea class="form-control border-dark" name="perut" rows="2"></textarea>
				</div>
				<div class="col-md-6">
					<label class="form-label">Lingkaran Bandi :</label>
					<input type="text" class="form-control border-dark" name="lingkaran_bandi">
				</div>
				<div class="col-md-6">
					<label class="form-label">Hepar :</label>
					<input type="text" class="form-control border-dark" name="hepar">
				</div>
				<div class="col-md-6">
					<label class="form-label">Lig. Rotum dum :</label>
					<input type="text" class="form-control border-dark" name="lig_rotum_dum">
				</div>
				<div class="col-md-6">
					<label class="form-label">Lien :</label>
					<input type="text" class="form-control border-dark" name="lien">
				</div>
				<div class="col-md-6">
					<label class="form-label">Taksiran B.B Anak :</label>
					<input type="text" class="form-control border-dark" name="taksiran_bb_anak">
				</div>
				<div class="col-md-6">
					<label class="form-label">Fundus Uteri :</label>
					<input type="text" class="form-control border-dark" name="fundus_uteri">
				</div>
				<div class="col-md-6">
					<label class="form-label">Formula Johnson :</label>
					<input type="text" class="form-control border-dark" name="formula_johnson">
				</div>
				<div class="col-md-6">
					<label class="form-label">Bagian Bawah :</label>
					<input type="text" class="form-control border-dark" name="bagian_bawah">
				</div>
				<div class="col-md-6">
					<label class="form-label">Osborn :</label>
					<input type="text" class="form-control border-dark" name="osborn">
				</div>
				<div class="col-md-6">
					<label class="form-label">Punggung Anak :</label>
					<input type="text" class="form-control border-dark" name="punggung_anak">
				</div>
				<div class="col-md-6">
					<label class="form-label">His :</label>
					<input type="text" class="form-control border-dark" name="his">
				</div>
				<div class="col-md-6">
					<label class="form-label">Turunnya :</label>
					<input type="text" class="form-control border-dark" name="turunnya">
				</div>
				<div class="col-md-6">
					<label class="form-label">D.J.J :</label>
					<input type="text" class="form-control border-dark" name="djj">
				</div>
			</div>
		</div>

		<div class="mb-4 mt-5">
			<div class="row g-3">
				<div class="col-md-6">
					<h5 class="mb-2">UKURAN PANGGUL LUAR</h5>
					<div class="mb-3">
						<label class="form-label">Dist. Spinarum :</label>
						<input type="text" class="form-control border-dark" name="dist_spinarum">
					</div>
					<div class="mb-3">
						<label class="form-label">Dist. Cristarum :</label>
						<input type="text" class="form-control border-dark" name="dist_cristarum">
					</div>
					<div class="mb-3">
						<label class="form-label">Conj. Eksterna :</label>
						<input type="text" class="form-control border-dark" name="conj_eksterna">
					</div>
					<div class="mb-3">
						<label class="form-label">Lingkaran Panggul :</label>
						<input type="text" class="form-control border-dark" name="lingkaran_panggul">
					</div>
				</div>
				<div class="col-md-6">
					<h5 class="mb-2">PELVIMETRI Sinar X</h5>
					<div class="mb-3">
						<label class="form-label">Conj. Vera :</label>
						<input type="text" class="form-control border-dark" name="conj_vera">
					</div>
					<div class="mb-3">
						<label class="form-label">Conj. Transversa :</label>
						<input type="text" class="form-control border-dark" name="conj_transversa">
					</div>
					<div class="mb-3">
						<label class="form-label">Conj. Obliqua :</label>
						<input type="text" class="form-control border-dark" name="conj_obliqua">
					</div>
					<div class="mb-3">
						<label class="form-label">Lain-lain :</label>
						<input type="text" class="form-control border-dark" name="lain_lain">
					</div>
				</div>
			</div>
		</div>

		<div class="d-flex justify-content-end flex-column">
			<div class="text-end">
				<label>Dokter / Bidan,</label>
			</div>
			<div class="d-flex justify-content-end">
				<img class="img-responsive center-block mt-2 my-2 " style="width: 10%;" id="qr_dokter_umum" />
			</div>
			<div class="d-flex justify-content-end">

				<select type="select" name="dokter_umum" class="form-select dokter_umum w-25"></select>
			</div>
		</div>
	</div>
</div>


<script>
	// ambil tdd dokter
	let dataDokter = []
	const mode = "<?= $mode; ?>"


	function cbCommon(data) {

		$('.dokter_umum').prop('disabled', false)
		$('.dokter_umum').select2('open')
		$('.dokter_umum').select2('close')
		if (mode === "lihat")
			$('.dokter_umum').prop('disabled', true)

		setTimeout(() => {
			console.log(dataDokter)
			dataDokter?.map(v => {
				if (v.text === $('.dokter_umum').select2('data')[0].text) {
					QRSignatureAPI(v.id_original, 'qr_dokter_umum')
				}
			})
		}, 500)
		// callMarkerManager();
		// fill image
	}

	function listDokterUmumAPI() {
		$('.dokter_umum').select2({
			ajax: {
				url: '<?= site_url('backend/admission/getKaryawan/5'); ?>',
				dataType: 'json',
				delay: 250,
				data: function(params) {
					return {
						q: params.term,
					}
				},
				processResults: function(data) {
					const {
						items,
						more
					} = data.data;
					dataDokter = items
					return {
						results: items, // Data from PHP
						pagination: {
							more: more, // Check if more data is available
						},
					};
				},
				cache: true,

			},
			placeholder: 'Search for items...',
		})
	}

	$(document).ready(function() {
		// ambil diagnosa
		let page = 1; // Track the current page
		// let searchQuery = ''; // Track the search query

		// Initialize Select2
		$('.diagnosa').select2({
			ajax: {
				url: '<?= site_url('backend/admission/getDiagnosa'); ?>', // PHP script to fetch data
				dataType: 'json',
				delay: 250, // Delay in ms while typing
				data: function(params) {
					console.log(" params", params)
					return {
						q: params.term, // Search query
						limit: 100, // Number of items per page
						offset: (page - 1) * 100, // Calculate offset
					};
				},
				processResults: function(data) {
					const {
						items,
						more
					} = data.data
					console.log(items, more)
					return {
						results: items, // Data from PHP
						pagination: {
							more: more, // Check if more data is available
						},
					};
				},
				cache: true,
			},
			placeholder: 'Search for items...',
			// minimumInputLength: 0,
		});

		$('.diagnosa').on('select2:open', function() {
			$('.select2-results__options').on('scroll', function() {
				const $this = $(this);
				if ($this.scrollTop() + $this.innerHeight() >= $this[0].scrollHeight) {
					page++; // Increment page
					$('.diagnosa').select2('data', null); // Trigger new data fetch
				}
			});
		});
		// batas diagnosa

		//global ambil tdd
		const globalData = <?= $global_data; ?>;
		const {
			id_dokter,
			id_perawat,
			nama_perawat
		} = globalData;

		$('#id_perawat_form').val($('#id_perawat_form').val() || id_perawat)
		$('#nama_perawat_form').val($('#nama_perawat_form').val() || nama_perawat)
		$('#nama_perawat_form').attr('disabled', true)

		QRSignatureAPI($('#id_perawat_form').val(), 'qr_perawat')

		listDokterUmumAPI()

		QRSignatureAPI(id_dokter, 'qr_dokter_dpjp')

		$('.dokter_umum').on('select2:select', function(e) {
			const {
				id_original
			} = e.params.data;
			QRSignatureAPI(id_original, 'qr_dokter_umum')
		});
		// batas tdd

	})
</script>